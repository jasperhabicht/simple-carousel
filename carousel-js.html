<!DOCTYPE html>
<html>
    <head>
        <title>Carousel</title>
        <base href="https://www.dino-bruns.de/" />

        <style>
            body {
                opacity: 1;
                transition: opacity .5s ease;
            }

            body.loading {
                opacity: 0;
            }

            .carousel {
                position: relative;
                width: 100%;
                height: 512px;
                white-space: nowrap;
                overflow: hidden;
            }

            .carousel .item {
                display: inline-block;
                min-height: 1px;
                width: auto;
                margin-right: 20px;
            }

            .carousel .item img {
                display: block;
                width: 100%;
            }

            .carousel .wrapper {
                position: absolute;
                display: inline-block;
                height: 100%;
                transition: transform .5s ease;
            }

            .carousel .wrapper.skip-transition {
                transition: none !important;
            }

            .carousel .nav {
                font-family: 'FontAwesome', Verdana, Helvetica, Arial, sans-serif;
                font-size: 5em;
            }

            .carousel .nav .next,
            .carousel .nav .prev {
                color: #fc0;
                top: 45%;
                position: absolute;
            }

            .carousel .nav .next:hover,
            .carousel .nav .next:focus,
            .carousel .nav .prev:hover,
            .carousel .nav .prev:focus {
                color: #ccc;
            }

            .carousel .nav .next {
                right: 0.5em;
            }

            .carousel .nav .prev {
                left: 0.5em;
            }
        </style>

    </head>

    <body class="loading">

    <div class="carousel">
        <div class="item"><img src="img/innenausbau/IMG_5529-512.jpg" alt="" /></div>
        <div class="item"><img src="img/innenausbau/IMG_5535-512.jpg" alt="" /></div>
        <div class="item"><img src="img/innenausbau/IMG_5523-512.jpg" alt="" /></div>
        <div class="item"><img src="img/innenausbau/IMG_5532-512.jpg" alt="" /></div>
        <div class="item"><img src="img/innenausbau/IMG_5557-512.jpg" alt="" /></div>
        <div class="item"><img src="img/innenausbau/IMG_5559-512.jpg" alt="" /></div>
        <div class="item"><img src="img/innenausbau/IMG_5549-512.jpg" alt="" /></div>
        <div class="item"><img src="img/innenausbau/IMG_5515-512.jpg" alt="" /></div>
        <div class="item"><img src="img/innenausbau/IMG_5129-512.jpg" alt="" /></div>
        <div class="item"><img src="img/innenausbau/IMG_5157-512.jpg" alt="" /></div>
        <div class="item"><img src="img/innenausbau/IMG_5160-512.jpg" alt="" /></div>
        <div class="item"><img src="img/innenausbau/IMG_5161-512.jpg" alt="" /></div>

        <div class="item"><img src="img/innenausbau/IMG_2184-512.jpg" alt="" /></div>
        <div class="item"><img src="img/innenausbau/IMG_2190-512.jpg" alt="" /></div>
        <div class="item"><img src="img/innenausbau/IMG_2189-512.jpg" alt="" /></div>
        <div class="item"><img src="img/innenausbau/IMG_2192-512.jpg" alt="" /></div>

        <div class="item"><img src="img/innenausbau/IMG_3689-512.jpg" alt="" /></div>
        <div class="item"><img src="img/innenausbau/IMG_3605-512.jpg" alt="" /></div>
        <div class="item"><img src="img/innenausbau/IMG_3606-512.jpg" alt="" /></div>
        <div class="item"><img src="img/innenausbau/IMG_3600-512.jpg" alt="" /></div>
        <div class="item"><img src="img/innenausbau/IMG_3601-512.jpg" alt="" /></div>
        <div class="item"><img src="img/innenausbau/IMG_3603-512.jpg" alt="" /></div>
        <div class="item"><img src="img/innenausbau/IMG_3625-512.jpg" alt="" /></div>
        <div class="item"><img src="img/innenausbau/IMG_3636-512.jpg" alt="" /></div>

        <div class="item"><img src="img/innenausbau/IMG_4385-512.jpg" alt="" /></div>
        <div class="item"><img src="img/innenausbau/IMG_4387-512.jpg" alt="" /></div>
        <div class="item"><img src="img/innenausbau/IMG_4398-512.jpg" alt="" /></div>

        <div class="item"><img src="img/innenausbau/IMG_3484-512.jpg" alt="" /></div>
        <div class="item"><img src="img/innenausbau/IMG_3484-512.jpg" alt="" /></div>
        <div class="item"><img src="img/innenausbau/IMG_3492-512.jpg" alt="" /></div>
        <div class="item"><img src="img/innenausbau/IMG_3485-512.jpg" alt="" /></div>
        <div class="item"><img src="img/innenausbau/IMG_3486-512.jpg" alt="" /></div>
        <div class="item"><img src="img/innenausbau/IMG_3488-512.jpg" alt="" /></div>
        <div class="item"><img src="img/innenausbau/IMG_3489-512.jpg" alt="" /></div>
        <div class="item"><img src="img/innenausbau/IMG_3495-512.jpg" alt="" /></div>
        <div class="item"><img src="img/innenausbau/IMG_3476-512.jpg" alt="" /></div>
        <div class="item"><img src="img/innenausbau/IMG_3478-512.jpg" alt="" /></div>
        <div class="item"><img src="img/innenausbau/IMG_3481-512.jpg" alt="" /></div>
        <div class="item"><img src="img/innenausbau/IMG_3483-512.jpg" alt="" /></div>
        <div class="item"><img src="img/innenausbau/IMG_2716-512.jpg" alt="" /></div>
        <div class="item"><img src="img/innenausbau/IMG_2718-512.jpg" alt="" /></div>
        <div class="item"><img src="img/innenausbau/IMG_2719-512.jpg" alt="" /></div>
        <div class="item"><img src="img/innenausbau/IMG_2720-512.jpg" alt="" /></div>
        <div class="item"><img src="img/innenausbau/IMG_2727-512.jpg" alt="" /></div>
        <div class="item"><img src="img/innenausbau/IMG_2728-512.jpg" alt="" /></div>
        <div class="item"><img src="img/innenausbau/IMG_3352-512.jpg" alt="" /></div>

        <div class="item"><img src="img/innenausbau/P1000184-512.jpg" alt="" /></div>
        <div class="item"><img src="img/innenausbau/P1000189-512.jpg" alt="" /></div>
        <div class="item"><img src="img/innenausbau/P1000193-512.jpg" alt="" /></div>

        <div class="item"><img src="img/innenausbau/IMG_1964-512.jpg" alt="" /></div>
        <div class="item"><img src="img/innenausbau/IMG_1961-512.jpg" alt="" /></div>

        <div class="item"><img src="img/innenausbau/IMG_1694-512.jpg" alt="" /></div>
        <div class="item"><img src="img/innenausbau/IMG_1713-512.jpg" alt="" /></div>
        <div class="item"><img src="img/innenausbau/IMG_1716-512.jpg" alt="" /></div>
        <div class="item"><img src="img/innenausbau/IMG_1718-512.jpg" alt="" /></div>
    </div>

    <script>
    (() => {
        const getNextItem = (carouselWrapper) => {
            const currentItem = carouselWrapper.getElementsByClassName('active')[0];
            currentItem.classList.remove('active');
            currentItem.nextSibling.classList.add('active');
            centerActiveItem(carouselWrapper);
            window.setTimeout(() => {
                if(currentItem.nextSibling.classList.contains('cloned')) {
                    currentItem.nextSibling.classList.remove('active');
                    carouselWrapper.getElementsByClassName('item')[5].classList.add('active');
                    centerActiveItem(carouselWrapper, false);
                }
            }, 550);
        }

        const getPrevItem = (carouselWrapper) => {
            const currentItem = carouselWrapper.getElementsByClassName('active')[0];
            currentItem.classList.remove('active');
            currentItem.previousSibling.classList.add('active');
            centerActiveItem(carouselWrapper);
            window.setTimeout(() => {
                if(currentItem.previousSibling.classList.contains('cloned')) {
                    currentItem.previousSibling.classList.remove('active');
                    carouselWrapper.getElementsByClassName('item')[carouselWrapper.getElementsByClassName('item').length - 6].classList.add('active');
                    centerActiveItem(carouselWrapper, false);
                } 
            }, 550);
        }

        const centerActiveItem = (carouselWrapper, animate = true) => {
            const currentItem = carouselWrapper.getElementsByClassName('active')[0];
            const currentItemOffset = carouselWrapper.parentElement.offsetWidth / 2 - currentItem.offsetLeft - currentItem.offsetWidth / 2;
            if(animate === false) {
                carouselWrapper.classList.add('skip-transition');
            }
            carouselWrapper.style.transform = 'translateX(' + parseInt(currentItemOffset) + 'px)';
            void carouselWrapper.offsetWidth;
            if(animate === false) {
                carouselWrapper.classList.remove('skip-transition');
            }
        }
        
        let touchMoveStartX = null;
        let touchMoveStartY = null;

        const touchUnifyMove = (event) => {
            return event.changedTouches ? event.changedTouches[0] : event;
        };

        const touchRecordPos = (event) => {
            touchMoveStartX = touchUnifyMove(event).clientX;
            touchMoveStartY = touchUnifyMove(event).clientY;
        };

        const touchRecordMove = (event, container) => {
            let touchDistanceX = 0;
            let touchDistanceY = 0;
            let touchError = 100;
            if(touchMoveStartX || touchMoveStartX === 0) {
                touchDistanceX = touchUnifyMove(event).clientX - touchMoveStartX; 
                touchMoveStartX = null;
            }
            if(touchMoveStartY || touchMoveStartY === 0) {
                touchDistanceY = touchUnifyMove(event).clientY - touchMoveStartY;
                touchMoveStartY = null;
            }
            if(Math.sign(touchDistanceX) < 0 && touchDistanceY < touchError && touchDistanceY > (-1 * touchError)) {
                getNextItem(container);
                return true;
            }
            if(Math.sign(touchDistanceX) > 0 && touchDistanceY < touchError && touchDistanceY > (-1 * touchError)) {
                getPrevItem(container);
                return true;
            }
            return false;
        };

        document.addEventListener('DOMContentLoaded', () => {
            const allCarousels = document.getElementsByClassName('carousel');
            for(let i = 0; i < allCarousels.length; i += 1) {
                const currentCarousel = allCarousels[i];
                new Promise((resolve, reject) => {
                    const carouselItemWrapper = document.createElement('div');
                    carouselItemWrapper.classList.add('wrapper');
                    currentCarousel.appendChild(carouselItemWrapper);
                    for(let j = currentCarousel.getElementsByClassName('item').length - 1; j >= 0; j -= 1) {
                        if(j == 0) {
                            allCarousels[i].getElementsByClassName('item')[j].classList.add('active');
                        }
                        carouselItemWrapper.insertAdjacentElement('afterbegin', allCarousels[i].getElementsByClassName('item')[j]);
                    }  
                    resolve(carouselItemWrapper);
                }).then((carouselItemWrapper) => {
                    const carouselItemsCount = carouselItemWrapper.getElementsByClassName('item').length;
                    for(let i = carouselItemsCount - 1; i > carouselItemsCount - 6; i -= 1) {
                        const clonedItem = carouselItemWrapper.getElementsByClassName('item')[carouselItemsCount - 1].cloneNode(true);
                        clonedItem.classList.remove('active');
                        clonedItem.classList.add('cloned');
                        clonedItem.classList.add('before');
                        carouselItemWrapper.insertAdjacentElement('afterBegin', clonedItem);
                    }  
                    for(let i = 5; i < 10; i += 1) {
                        const clonedItem = carouselItemWrapper.getElementsByClassName('item')[i].cloneNode(true);
                        clonedItem.classList.remove('active');
                        clonedItem.classList.add('cloned');
                        clonedItem.classList.add('after');
                        carouselItemWrapper.insertAdjacentElement('beforeEnd', clonedItem);
                    }
                    for(let i = 10; i < carouselItemWrapper.getElementsByClassName('item').length; i += 1) {
                        carouselItemWrapper.getElementsByClassName('item')[i].getElementsByTagName('img')[0].setAttribute('loading', 'lazy');
                    }
                    return carouselItemWrapper;
                }).then((carouselItemWrapper) => {
                    const carouselNavigation = document.createElement('div');
                    carouselNavigation.classList.add('nav');
                    const carouselButtonPrev = document.createElement('div');
                    carouselButtonPrev.classList.add('prev');
                    carouselButtonPrev.textContent = '\uF053';
                    carouselButtonPrev.addEventListener('click', () => {
                        getPrevItem(carouselItemWrapper);
                    });
                    const carouselButtonNext = document.createElement('div');
                    carouselButtonNext.classList.add('next');
                    carouselButtonNext.textContent = '\uF054';
                    carouselButtonNext.addEventListener('click', () => {
                        getNextItem(carouselItemWrapper);
                    });
                    carouselNavigation.appendChild(carouselButtonPrev);
                    carouselNavigation.appendChild(carouselButtonNext);

                    currentCarousel.appendChild(carouselNavigation);

                    currentCarousel.addEventListener('touchstart', (event) => {
                        touchRecordPos(event);
                    }, false);

                    currentCarousel.addEventListener('touchend', (event) => {
                        touchRecordMove(event, carouselItemWrapper);
                    }, false);

                }).catch((error) => {
                    console.log(error);
                    return Promise.reject(error);
                });
            }
        });

        window.addEventListener('load', () => {
            const allCarousels = document.getElementsByClassName('carousel');
            for(let i = 0; i < allCarousels.length; i += 1) {
                centerActiveItem(allCarousels[i].getElementsByClassName('wrapper')[0], false);
            }
            document.body.classList.remove('loading');
        });

        let resizeTimeout = false;
        window.addEventListener('resize', () => {
            clearTimeout(resizeTimeout);
            resizeTimeout = setTimeout(() => {
                const allCarousels = document.getElementsByClassName('carousel');
                for(let i = 0; i < allCarousels.length; i += 1) {
                    centerActiveItem(allCarousels[i].getElementsByClassName('wrapper')[0], false);
                }
            }, 500);
        }, false);
    })();
    </script>

    </body>
</html>
