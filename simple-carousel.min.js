/** * simple-carousel * @version 1.2.0 * @author Jasper Habicht * @license The MIT License (MIT) */
class Carousel{constructor(e,t={appendRepeat:5,loadSensitivity:5,hasNavigation:!0,navigationPrevSymbol:"◀",navigationNextSymbol:"▶",hasTouch:!0,touchError:100,jumpBackTimeout:550,resizeRepaintTimeout:250}){this.carouselParent=e,this.id=e.id,this.appendRepeat=t.appendRepeat,this.loadSensitivity=t.loadSensitivity,this.hasNavigation=t.hasNavigation,this.navigationPrevSymbol=t.navigationPrevSymbol,this.navigationNextSymbol=t.navigationNextSymbol,this.hasTouch=t.hasTouch,this.touchError=t.touchError,this.jumpBackTimeout=t.jumpBackTimeout,this.resizeRepaintTimeout=t.resizeRepaintTimeout,Carousel.all.push(this)}static all=[];static touchMoveStartX=null;static touchMoveStartY=null;static touchUnify=e=>e.changedTouches?e.changedTouches[0]:e;touchRecordPosition=e=>(this.touchMoveStartX=Carousel.touchUnify(e).clientX,this.touchMoveStartY=Carousel.touchUnify(e).clientY,!0);touchRecordMove=e=>{let t=0,i=0;return(this.touchMoveStartX||0===this.touchMoveStartX)&&(t=Carousel.touchUnify(e).clientX-this.touchMoveStartX,this.touchMoveStartX=null),(this.touchMoveStartY||0===this.touchMoveStartY)&&(i=Carousel.touchUnify(e).clientY-this.touchMoveStartY,this.touchMoveStartY=null),Math.sign(t)<0&&i<this.touchError&&i>-1*this.touchError?(this.getNextItem(),!0):Math.sign(t)>0&&i<this.touchError&&i>-1*this.touchError&&(this.getPrevItem(),!0)};unhideAfterLoading=e=>{const t=Array(e.length).fill(1);for(let i=0,s=e.length;i<s;i+=1)e[i].addEventListener("load",(()=>(t[i]=0,0===t.reduce(((e,t)=>e+t),0)&&(this.carouselParent.classList.remove("loading"),!0))),{once:!0}),e[i].complete&&e[i].load();return!1};centerActiveItem=(e=!0)=>{const t=this.carouselParent.querySelector(".wrapper"),i=t.querySelector(".active"),s=this.carouselParent.offsetWidth/2-i.offsetLeft-i.offsetWidth/2;return!1===e&&t.classList.add("skip-transition"),t.style.transform=`translateX(${parseInt(s,10)}px)`,t.offsetWidth,!1===e&&t.classList.remove("skip-transition"),!0};getNextItem=()=>{0===this.carouselParent.querySelectorAll(".item.active").length&&this.carouselParent.querySelectorAll(".item")[0].classList.add("active");const e=this.carouselParent.querySelector(".wrapper"),t=e.querySelector(".active");t.classList.remove("active");try{t.nextSibling.classList.add("active")}catch(e){console.debug("Next item currently not accessible.")}return this.centerActiveItem(),window.setTimeout((()=>{try{t.nextSibling.classList.contains("cloned")&&(t.nextSibling.classList.remove("active"),e.querySelectorAll(".item")[this.appendRepeat].classList.add("active"),this.centerActiveItem(!1))}catch(e){console.debug("Next item currently not accessible.")}}),this.jumpBackTimeout),!0};getPrevItem=()=>{0===this.carouselParent.querySelectorAll(".item.active").length&&this.carouselParent.querySelectorAll(".item")[0].classList.add("active");const e=this.carouselParent.querySelector(".wrapper"),t=e.querySelector(".active");t.classList.remove("active");try{t.previousSibling.classList.add("active")}catch(e){console.debug("Previous item currently not accessible.")}return this.centerActiveItem(),window.setTimeout((()=>{try{t.previousSibling.classList.contains("cloned")&&(t.previousSibling.classList.remove("active"),e.querySelectorAll(".item")[this.carouselParent.querySelectorAll(".item").length-(this.appendRepeat+1)].classList.add("active"),this.centerActiveItem(!1))}catch(e){console.debug("Previous item currently not accessible.")}}),this.jumpBackTimeout),!0};initialize=()=>{new Promise(((e,t)=>{const i=document.createElement("div");i.classList.add("wrapper"),this.carouselParent.appendChild(i);for(let e=this.carouselParent.querySelectorAll(".item").length-1;e>=0;e-=1)i.insertAdjacentElement("afterbegin",this.carouselParent.querySelectorAll(".item")[e]);this.carouselParent.querySelectorAll(".item")[0].classList.add("active"),e(i)})).then((e=>{const t=e.querySelectorAll(".item").length;for(let i=t-1,s=t-(this.appendRepeat+1);i>s;i-=1){const i=e.querySelectorAll(".item")[t-1].cloneNode(!0);i.classList.remove("active"),i.classList.add("cloned"),i.classList.add("before"),e.insertAdjacentElement("afterBegin",i)}for(let t=this.appendRepeat,i=2*this.appendRepeat;t<i;t+=1){const i=e.querySelectorAll(".item")[t].cloneNode(!0);i.classList.remove("active"),i.classList.add("cloned"),i.classList.add("after"),e.insertAdjacentElement("beforeEnd",i)}const i=[];for(let e=0,t=this.loadSensitivity;e<t;e+=1)try{i.push(this.carouselParent.querySelectorAll(".item img")[e])}catch(t){console.debug(`Item ${e} has no IMG tag.`)}return this.unhideAfterLoading(i),e})).then((e=>{if(this.hasNavigation){const e=document.createElement("div");e.classList.add("nav");const t=document.createElement("div");t.classList.add("prev"),t.textContent=this.navigationPrevSymbol,t.addEventListener("click",(()=>{this.getPrevItem()}));const i=document.createElement("div");i.classList.add("next"),i.textContent=this.navigationNextSymbol,i.addEventListener("click",(()=>{this.getNextItem()})),e.appendChild(t),e.appendChild(i),this.carouselParent.appendChild(e)}return this.hasTouch&&(this.carouselParent.addEventListener("touchstart",(e=>{this.touchRecordPosition(e)}),{passive:!0},!1),this.carouselParent.addEventListener("touchend",(e=>{this.touchRecordMove(e)}),{passive:!0},!1)),!0})).catch((e=>(console.log(e),Promise.reject(e))))}}const SimpleCarousel=new function(){const e=[];this.select=t=>e[t],document.addEventListener("DOMContentLoaded",(()=>{const t=document.querySelectorAll(".carousel");for(let i=0,s=t.length;i<s;i+=1){const s=new Carousel(t[i]);e[s.id||i]=s,s.initialize()}})),window.addEventListener("load",(()=>{Object.values(e).forEach((e=>{e.centerActiveItem()}))}));let t=!1;window.addEventListener("resize",(()=>{clearTimeout(t),t=setTimeout((()=>{Object.values(e).forEach((e=>{e.centerActiveItem(!1)}))}),this.resizeRepaintTimeout)}),!1)};