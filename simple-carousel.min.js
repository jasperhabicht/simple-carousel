/** * simple-carousel * @version 1.3.0 * @author Jasper Habicht * @license The MIT License (MIT) */
class Carousel{constructor(t,e){this.carouselParent=t,this.id=t.id,this.appendRepeat=e.appendRepeat,this.loadSensitivity=e.loadSensitivity,this.hasNavigation=e.hasNavigation,this.navigationPrevSymbol=e.navigationPrevSymbol,this.navigationNextSymbol=e.navigationNextSymbol,this.hasAutoplay=e.hasAutoplay,this.autoplayDelay=e.autoplayDelay,this.hasTouch=e.hasTouch,this.touchError=e.touchError,this.jumpBackTimeout=e.jumpBackTimeout,this.resizeRepaintTimeout=e.resizeRepaintTimeout,Carousel.all.push(this)}static all=[];static touchMoveStartX=null;static touchMoveStartY=null;static touchUnify=t=>t.changedTouches?t.changedTouches[0]:t;touchRecordPosition=t=>(this.touchMoveStartX=Carousel.touchUnify(t).clientX,this.touchMoveStartY=Carousel.touchUnify(t).clientY,!0);touchRecordMove=t=>{let e=0,i=0;return(this.touchMoveStartX||0===this.touchMoveStartX)&&(e=Carousel.touchUnify(t).clientX-this.touchMoveStartX,this.touchMoveStartX=null),(this.touchMoveStartY||0===this.touchMoveStartY)&&(i=Carousel.touchUnify(t).clientY-this.touchMoveStartY,this.touchMoveStartY=null),Math.sign(e)<0&&i<this.touchError&&i>-1*this.touchError?(this.getNextItem(),!0):Math.sign(e)>0&&i<this.touchError&&i>-1*this.touchError&&(this.getPrevItem(),!0)};unhideAfterLoading=t=>{const e=Array(t.length).fill(1);for(let i=0,s=t.length;i<s;i+=1)t[i].addEventListener("load",(()=>(e[i]=0,0===e.reduce(((t,e)=>t+e),0)&&(this.carouselParent.classList.remove("loading"),!0))),{once:!0}),t[i].complete&&t[i].load();return!1};centerActiveItem=(t=!0)=>{const e=this.carouselParent.querySelector(".wrapper"),i=e.querySelector(".active"),s=this.carouselParent.offsetWidth/2-i.offsetLeft-i.offsetWidth/2;return!1===t&&e.classList.add("skip-transition"),e.style.transform=`translateX(${parseInt(s,10)}px)`,e.offsetWidth,!1===t&&e.classList.remove("skip-transition"),!0};getNextItem=()=>{0===this.carouselParent.querySelectorAll(".item.active").length&&this.carouselParent.querySelectorAll(".item")[0].classList.add("active");const t=this.carouselParent.querySelector(".wrapper"),e=t.querySelector(".active");e.classList.remove("active");try{e.nextSibling.classList.add("active")}catch(t){console.debug("Next item currently not accessible.")}return this.centerActiveItem(),window.setTimeout((()=>{try{e.nextSibling.classList.contains("cloned")&&(e.nextSibling.classList.remove("active"),t.querySelectorAll(".item")[this.appendRepeat].classList.add("active"),this.centerActiveItem(!1))}catch(t){console.debug("Next item currently not accessible.")}}),this.jumpBackTimeout),!0};getPrevItem=()=>{0===this.carouselParent.querySelectorAll(".item.active").length&&this.carouselParent.querySelectorAll(".item")[0].classList.add("active");const t=this.carouselParent.querySelector(".wrapper"),e=t.querySelector(".active");e.classList.remove("active");try{e.previousSibling.classList.add("active")}catch(t){console.debug("Previous item currently not accessible.")}return this.centerActiveItem(),window.setTimeout((()=>{try{e.previousSibling.classList.contains("cloned")&&(e.previousSibling.classList.remove("active"),t.querySelectorAll(".item")[this.carouselParent.querySelectorAll(".item").length-(this.appendRepeat+1)].classList.add("active"),this.centerActiveItem(!1))}catch(t){console.debug("Previous item currently not accessible.")}}),this.jumpBackTimeout),!0};initialize=()=>{new Promise(((t,e)=>{const i=document.createElement("div");i.classList.add("wrapper"),this.carouselParent.appendChild(i);for(let t=this.carouselParent.querySelectorAll(".item").length-1;t>=0;t-=1)i.insertAdjacentElement("afterbegin",this.carouselParent.querySelectorAll(".item")[t]);this.carouselParent.querySelectorAll(".item")[0].classList.add("active"),t(i)})).then((t=>{const e=t.querySelectorAll(".item").length;for(let i=e-1,s=e-(this.appendRepeat+1);i>s;i-=1){const i=t.querySelectorAll(".item")[e-1].cloneNode(!0);i.classList.remove("active"),i.classList.add("cloned"),i.classList.add("before"),t.insertAdjacentElement("afterBegin",i)}for(let e=this.appendRepeat,i=2*this.appendRepeat;e<i;e+=1){const i=t.querySelectorAll(".item")[e].cloneNode(!0);i.classList.remove("active"),i.classList.add("cloned"),i.classList.add("after"),t.insertAdjacentElement("beforeEnd",i)}const i=[];for(let t=0,e=this.loadSensitivity;t<e;t+=1)try{i.push(this.carouselParent.querySelectorAll(".item img")[t])}catch(e){console.debug(`Item ${t} has no IMG tag.`)}return this.unhideAfterLoading(i),t})).then((t=>{if(this.hasNavigation){const t=document.createElement("div");t.classList.add("nav");const e=document.createElement("div");e.classList.add("prev"),e.textContent=this.navigationPrevSymbol,e.addEventListener("click",(()=>{this.getPrevItem()}));const i=document.createElement("div");i.classList.add("next"),i.textContent=this.navigationNextSymbol,i.addEventListener("click",(()=>{this.getNextItem()})),t.appendChild(e),t.appendChild(i),this.carouselParent.appendChild(t)}this.hasTouch&&(this.carouselParent.addEventListener("touchstart",(t=>{this.touchRecordPosition(t)}),{passive:!0},!1),this.carouselParent.addEventListener("touchend",(t=>{this.touchRecordMove(t)}),{passive:!0},!1)),window.addEventListener("load",(()=>{this.centerActiveItem(),this.hasAutoplay&&setInterval((()=>{SimpleCarousel.select("carousel-1").getNextItem()}),this.autoplayDelay)}));let e=!1;return window.addEventListener("resize",(()=>{clearTimeout(e),e=setTimeout((()=>{this.centerActiveItem(!1)}),this.resizeRepaintTimeout)}),!1),!0})).catch((t=>(console.log(t),Promise.reject(t))))}}const SimpleCarousel=new function(){const t={appendRepeat:5,loadSensitivity:5,hasNavigation:!0,navigationPrevSymbol:"◀",navigationNextSymbol:"▶",hasAutoplay:!1,autoplayDelay:5e3,hasTouch:!0,touchError:100,jumpBackTimeout:550,resizeRepaintTimeout:250},e=[];this.select=t=>e[t],this.create=(i,s)=>{document.addEventListener("DOMContentLoaded",(()=>{const a=new Carousel(document.getElementById(i),{...t,...s});e[i]=a,a.initialize()}))}};